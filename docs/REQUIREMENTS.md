# Qx 要求定義書

---
version: 1.0.0
last_updated: 2025-08-12
author: Development Team
status: draft
---

## 📋 概要

本書は、Qx（Query eXpress）の機能要求、非機能要求、制約条件を定義します。
Qxは、OpenAI APIを活用したWeb検索機能を持つCLIツールです。

## 🎯 機能要求

### FR-001: OpenAI API基本機能

#### ユーザーストーリー
**開発者として**、ターミナルから直接OpenAI APIを呼び出したい、**なぜなら**ブラウザへの切り替えなしに技術的な問題を解決したいから。

#### 受け入れ基準
- [ ] コマンドラインから質問文を入力できる
- [ ] OpenAI APIへリクエストを送信できる
- [ ] APIからの応答を標準出力に表示できる
- [ ] エラー発生時は簡潔なエラーメッセージを表示する

#### 優先度
**Must Have**

---

### FR-002: Web検索統合機能

#### ユーザーストーリー
**エンジニアとして**、LLMが自動的にWeb検索を実行して回答を生成してほしい、**なぜなら**最新の情報や複数の情報源からの統合された回答が必要だから。

#### 受け入れ基準
- [x] OpenAI APIのWeb検索機能を有効化できる
- [x] GitHub Issues、Stack Overflow等の技術情報源を検索できる
- [x] 検索結果を統合した回答を生成できる
- [x] Web検索なしでの実行も選択できる

#### 優先度
**Must Have**

---

### FR-003: API呼び出しオプション設定

#### ユーザーストーリー
**パワーユーザーとして**、reasoning_effortなどのAPIパラメータを調整したい、**なぜなら**用途に応じて速度と精度のバランスを最適化したいから。

#### 受け入れ基準
- [ ] reasoning_effort（low/medium/high）を設定できる
- [ ] 検索コンテキストサイズ（low/medium/high）を設定できる
- [ ] コマンドライン引数で動的に指定できる
- [ ] 設定ファイルでデフォルト値を定義できる

#### 優先度
**Should Have**

---

### FR-004: AIエージェント連携

#### ユーザーストーリー
**AIエージェント開発者として**、他のツールやスクリプトからqxコマンドを呼び出したい、**なぜなら**既存のワークフローに統合したいから。

#### 受け入れ基準
- [ ] 標準入力から質問を受け取れる
- [ ] 標準出力に構造化されたテキストを出力できる
- [ ] 終了コードで成功/失敗を示せる
- [ ] パイプやリダイレクトと互換性がある

#### 優先度
**Should Have**

---

### FR-005: 設定管理

#### ユーザーストーリー
**ユーザーとして**、デフォルト設定をカスタマイズしたい、**なぜなら**毎回同じオプションを指定するのは面倒だから。

#### 受け入れ基準
- [ ] 設定ファイル（.qxrc、qx.config等）を読み込める
- [ ] APIキー、デフォルトパラメータを設定できる
- [ ] 環境変数による設定の上書きができる
- [ ] 設定の優先順位が明確（コマンドライン > 環境変数 > 設定ファイル）

#### 優先度
**Could Have**

## 🔧 非機能要求

### NFR-001: パフォーマンス要求

#### 応答時間
- **目標値**: 平均応答時間 30秒以内
- **最大値**: タイムアウト 60秒
- **測定条件**: 標準的なWeb検索を含む質問に対して

#### スループット
- 同時実行に関する制限は、OpenAI APIの制限に準拠
- ローカルでの並列実行は制限なし

---

### NFR-002: 可用性要求

#### システム稼働率
- CLIツールのため、常時稼働は不要
- OpenAI APIの可用性に依存

#### エラー処理
- ネットワークエラー時は適切なエラーメッセージを表示
- API制限エラー時は待機時間を含むメッセージを表示
- 部分的な失敗でも可能な限り結果を返す

---

### NFR-003: セキュリティ要求

#### 認証・認可
- OpenAI APIキーは環境変数`OPENAI_API_KEY`から取得
- APIキーはメモリ内でのみ保持、ログには出力しない
- 設定ファイルに保存する場合は、適切なファイル権限（600）を推奨

#### データ保護
- ユーザーの質問内容はローカルに保存しない
- 検索履歴の記録機能は実装しない
- APIとの通信はHTTPS必須

---

### NFR-004: ユーザビリティ要求

#### 使いやすさ
- インストール後、最小限の設定で動作開始可能
- エラーメッセージは簡潔で理解しやすい
- ヘルプコマンドで主要な使い方を確認可能

#### 学習曲線
- 基本的な使用方法は5分以内に習得可能
- 一般的なCLIツールの慣習に従う（--help、--version等）

---

### NFR-005: 移植性要求

#### 対応プラットフォーム
1. **Linux** - 最優先サポート
2. **macOS** - 優先サポート  
3. **Windows** - ベストエフォート

#### システム要件
- .NET AoT（Ahead-of-Time）コンパイル済みバイナリの実行要件
  - x64アーキテクチャ
  - 最小メモリ: 128MB
  - ディスク容量: 50MB以下（バイナリサイズ）

## ⚖️ 制約条件

### ビジネス制約

#### ライセンス
- MITライセンスで公開
- 商用利用可能
- 改変・再配布自由

#### コスト
- OpenAI API利用料はユーザー負担
- ツール自体は無料

### 技術制約

#### 外部依存
- OpenAI APIへのアクセス必須
- インターネット接続必須
- 有効なOpenAI APIキー必須

#### 開発言語・フレームワーク
- .NET 8以降を使用
- AoTコンパイルによるネイティブバイナリ生成

### 法規制・コンプライアンス

#### データプライバシー
- GDPR等のデータ保護規制を考慮
- ユーザーデータの収集・保存を最小限に

#### 利用規約
- OpenAI利用規約の遵守
- 不適切なコンテンツのフィルタリングはOpenAI側に依存

## 📌 前提条件と依存関係

### 前提条件

1. ユーザーはターミナル操作の基本知識を持つ
2. ユーザーはOpenAI APIキーを取得済み
3. 対象ユーザーは主に技術者（開発者、エンジニア）

### 依存関係

1. **OpenAI API**
   - Web検索機能を含むAPIアクセス権限
   - 安定したAPIエンドポイント

2. **ネットワーク**
   - 安定したインターネット接続
   - HTTPSプロトコルのサポート

3. **実行環境**
   - .NET AoTランタイムの互換性
   - 標準入出力のサポート

## 📊 要求トレーサビリティ

| 要求ID | 関連するPRODUCT.md項目 | 検証方法 |
|--------|------------------------|----------|
| FR-001 | コアバリュー: インテリジェント検索 | 統合テスト |
| FR-002 | 技術的特徴: OpenAI API統合 | 統合テスト |
| FR-003 | 技術的特徴: 検索コンテキストサイズ設定 | 単体テスト |
| FR-004 | AIエージェント対応 | 統合テスト |
| NFR-001 | 成功指標: 平均レスポンス時間 | パフォーマンステスト |
| NFR-003 | セキュリティ要求 | セキュリティ監査 |

## 🔄 変更履歴

| 日付 | バージョン | 変更内容 | 変更者 |
|------|------------|----------|--------|
| 2025-08-12 | 1.0.0 | 初版作成 | Development Team |

---

*このドキュメントは、実装の詳細ではなく「何を」実現するかに焦点を当てています。「どのように」実現するかは [TECH.md](./TECH.md) を参照してください。*